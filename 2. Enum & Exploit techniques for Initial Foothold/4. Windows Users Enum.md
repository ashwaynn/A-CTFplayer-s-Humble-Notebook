# Enumerating users on a Windows Machine

## RID Brute Force Attack

### *A quick gist on RID and SID :*
`RID` (Relative Identifier) is the last part of an `SID` (Security Identifier) that uniquely identifies an account or group.

The `SID` for a local account or group is issued by the `LSA` (Local Security Authority) and is stored in the `SAM` file. On the other hand, a domain account or group's SID is issued by Domain Security Authority and is stored as a User/Group object's attribute in `ADDS`.

- *For further reading, check out:*
- https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-identifiers

### Tool 1 : impacket-lookupsid

```bash
impacket-lookupsid randomuser@manager.htb -no-pass
```

> *NOTE : In this case, 'randomuser' is a non-existent user.*

`-no-pass` - Specifies not to ask for a password.

### Tool 2 : netexec

Using the *guest* account while using `netexec`.

```bash
netexec smb <IP> -u guest -p '' --rid-brute
```

### Tool 3 : CrackMapExec

```bash
crackmapexec smb <IP> -u anonymous -p "" --rid-brute 5000
```

`--rid-brute [MAX_RID]` - Enumerates users by bruteforcing RIDs up to the specified value (default is 4000).


## Bruteforcing Kerberos for enumerating AD users on a Domain Controller

Kerberos mostly runs on `UDP` port 88, but also resorts to `TCP` for larger tickets. So the service `kerberos-sec` can be found to be running on **88/TCP**.

### Tool 1 : kerbrute

> https://github.com/ropnop/kerbrute

```bash
./kerbrute userenum <USERNAMES-WORDLIST> --dc dc01.manager.htb -d manager.htb
```

`--dc` - Specifies the location of the Domain Controller (can also be specified as an IP).

`-d` -  Domain name.

> *NOTE : Check out the 'Usernames' folder of `SecLists` for a suitable wordlist.*

